---
tags:
  - å·¥å…·/AI
---
# Product Requirement Document: p2r

| **é¡¹ç›®**   | **å†…å®¹**                                   |
| -------- | ---------------------------------------- |
| **äº§å“åç§°** | p2r (PDF/Print to Reading)               |
| **æ ¸å¿ƒå®šä½** | æç®€ä¸»ä¹‰çš„å­¦æœ¯é˜…è¯»æµè‡ªåŠ¨åŒ–å·¥å…· (CLI)                    |
| **å…³é”®ç‰¹æ€§** | é˜…è¯»/ç¬”è®°åˆ†ç¦»ã€MinerU é«˜ç²¾åº¦è§£æã€PicGo å›¾åºŠé›†æˆã€åŠ¨æ€å…ƒæ•°æ®é‡å‘½å |

---

## 1. äº§å“æ¦‚è¿°ä¸å·¥ä½œæµ (Product Overview & Workflow)

`p2r` æ—¨åœ¨è§£å†³å­¦æœ¯æ–‡çŒ®ç®¡ç†ä¸­â€œæ–‡ä»¶æ•£ä¹±â€ä¸â€œé˜…è¯»ä½“éªŒå‰²è£‚â€çš„é—®é¢˜ã€‚å®ƒä½œä¸ºä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œè¿æ¥äº†æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€äº‘ç«¯ AI è§£ææœåŠ¡ (MinerU) å’Œ ç¬”è®°è½¯ä»¶ (Obsidian)ã€‚

### å…¸å‹ç”¨æˆ·åœºæ™¯ (The User Journey)

1. **å‡†å¤‡é˜¶æ®µ**ï¼šç”¨æˆ·åˆšåˆšä¸‹è½½äº†ä¸€ç¯‡åä¸º `10.1109@CVPR.2024.pdf` çš„è®ºæ–‡ï¼Œä¿å­˜åœ¨ `~/Downloads/Papers` ç›®å½•ä¸‹ã€‚
    
2. **è§¦å‘åŠ¨ä½œ**ï¼š
    
    - ç”¨æˆ·åœ¨è¯¥ç›®å½•ä¸‹æ‰“å¼€ç»ˆç«¯ (Terminal/iTerm2)ã€‚
        
    - è¾“å…¥å‘½ä»¤ï¼š`p2r convert ./10.1109@CVPR.2024.pdf --author "Zhang" --year "2024" --conf "CVPR"`ã€‚ï¼ˆæ›´ä¸€èˆ¬çš„æƒ…å†µï¼Œä¸è¾“å…¥é¢å¤–ä¿¡æ¯ï¼Œè¯†åˆ«æ–‡çŒ®ä¿¡æ¯å¹¶åŒ¹é…ï¼‰
        
3. **é»‘ç›’å¤„ç† (Automated Process)**ï¼š
    
    - å·¥å…·è‡ªåŠ¨å°† PDF ä¸Šä¼ è‡³ MinerU è¿›è¡Œè§£æã€‚
        
    - è§£æå®Œæˆåï¼Œå·¥å…·ä¸‹è½½ç»“æœå¹¶è¿›è¡Œæ¸…æ´—ã€‚
        
    - å›¾ç‰‡è‡ªåŠ¨ä¸Šä¼ è‡³ PicGo æœåŠ¡å™¨ï¼Œè·å–äº‘ç«¯é“¾æ¥ã€‚
        
4. **æœ€ç»ˆäº¤ä»˜ (Delivery)**ï¼š
    
    - **é˜…è¯»æ–‡ä»¶ (HTML)**ï¼šè¢«ç§»åŠ¨åˆ°ç”¨æˆ·æŒ‡å®šçš„â€œHTML é˜…è¯»åº“â€æ–‡ä»¶å¤¹ï¼Œç”¨æˆ·é€šè¿‡æµè§ˆå™¨æ‰“å¼€é˜…è¯»ï¼ˆåˆ©ç”¨ AI æ’ä»¶è¾…åŠ©ï¼‰ã€‚
        
    - **ç¬”è®°æ–‡ä»¶ (Markdown)**ï¼šè¢«ç§»åŠ¨åˆ°â€œObsidian ä»“åº“â€æŒ‡å®šä½ç½®ã€‚æ–‡ä»¶åå·²æŒ‰è§„åˆ™é‡å‘½åï¼Œä¸”å†…å«æŒ‡å‘ HTML æ–‡ä»¶çš„é“¾æ¥ï¼Œå›¾ç‰‡ä¹Ÿå·²æ›¿æ¢ä¸ºå›¾åºŠé“¾æ¥ã€‚
        
5. **ç»“æœ**ï¼šç”¨æˆ·åœ¨ Obsidian ä¸­çœ‹åˆ°æ–°ç¬”è®°å‡ºç°ï¼Œç‚¹å‡»ç¬”è®°å¤´éƒ¨çš„ `local_url` å¼€å§‹é˜…è¯»ï¼Œä¸€è¾¹çœ‹ç½‘é¡µä¸€è¾¹åœ¨ Obsidian è®°ç¬”è®°ã€‚
    

---

## 2. åŠŸèƒ½éœ€æ±‚è§„æ ¼ (Functional Requirements)

### 2.1 äº¤äº’å¼åˆå§‹åŒ–é…ç½®

é¦–æ¬¡è¿è¡Œæˆ–è¾“å…¥ `p2r configure` æ—¶ï¼Œå¯åŠ¨ TUI å‘å¯¼ã€‚

- **MinerU é…ç½®**ï¼šè¾“å…¥ API Tokenã€‚
    
- **è·¯å¾„é…ç½®**ï¼š
    
    - `Obsidian Vault Path`: ç¬”è®°å­˜æ”¾æ ¹ç›®å½•ã€‚
        
    - `HTML Library Path`: çº¯å‡€ HTML é˜…è¯»æ–‡ä»¶å­˜æ”¾ç›®å½•ã€‚
        
- **æœåŠ¡é›†æˆ**ï¼š
    
    - **PicGo è®¾ç½®**ï¼šé…ç½® Server åœ°å€ï¼ˆé»˜è®¤ `http://127.0.0.1:36677`ï¼‰ï¼Œå¼€å…³çŠ¶æ€ã€‚
        
- **å‘½ååå¥½**ï¼š
    
    - é€‰æ‹©é»˜è®¤é‡å‘½åæ¨¡æ¿ï¼š`Standard` (Author-Year-Title) æˆ– `BibTeX` (AuthorYearTitle)ã€‚
        

### 2.2 æ ¸å¿ƒè½¬æ¢å¼•æ“

å‘½ä»¤ï¼š`p2r convert [FILE] [ARGS]`

- **æ¨¡ç³Šå‚æ•°è¾“å…¥**ï¼šæ”¯æŒæ¥æ”¶ä»»æ„æ•°é‡çš„åŠ¨æ€å‚æ•°ï¼ˆ`**kwargs`ï¼‰ï¼Œå¦‚ `--journal`, `--tags`, `--publisher`ã€‚è¿™äº›å‚æ•°ä¸è¢«ç¡¬ç¼–ç ï¼Œè€Œæ˜¯ç›´æ¥å­˜å…¥å…ƒæ•°æ®å­—å…¸ï¼Œä¾›é‡å‘½åå’Œ YAML æ³¨å…¥ä½¿ç”¨ã€‚
    
- **MinerU Batch æµç¨‹**ï¼šä¸¥æ ¼éµå¾ª `ç”³è¯·ä¸Šä¼ é“¾æ¥ -> ä¸Šä¼ æ–‡ä»¶ -> è½®è¯¢è¿›åº¦ -> ä¸‹è½½ç»“æœ` çš„å¼‚æ­¥é—­ç¯ã€‚
    
- **PicGo å›¾ç‰‡æ‰˜ç®¡**ï¼š
    
    - è§£æ ZIP åŒ…å†…çš„å›¾ç‰‡ã€‚
        
    - è°ƒç”¨æœ¬åœ° PicGo æ¥å£ä¸Šä¼ å›¾ç‰‡ã€‚
        
    - **å¤±è´¥å›é€€æœºåˆ¶**ï¼šè‹¥ PicGo æœªå“åº”ï¼Œè‡ªåŠ¨é™çº§ä¸ºâ€œå¤åˆ¶å›¾ç‰‡åˆ° Obsidian æœ¬åœ° assets ç›®å½•â€å¹¶ä¿®æ”¹å¼•ç”¨è·¯å¾„ã€‚
        

### 2.3 æ™ºèƒ½é‡å‘½åç³»ç»Ÿ

æ”¯æŒå¯¹â€œæºæ–‡ä»¶â€ã€â€œHTMLäº§ç‰©â€ã€â€œMarkdownäº§ç‰©â€åº”ç”¨ä¸åŒçš„å‘½åç­–ç•¥ã€‚

- **æ¨¡æ¿å¼•æ“**ï¼šæ”¯æŒä½¿ç”¨ Python f-string é£æ ¼çš„å ä½ç¬¦ã€‚
    
- **é¢„è®¾æ–¹æ¡ˆ**ï¼š
    
    - `Standard`: `{author}-{year}-{title}`
        
    - `BibTeX`: `{author}{year}{title.split(' ')[0]}` (ç¤ºä¾‹é€»è¾‘)
        

---

## 3. æ•°æ®ç»“æ„è®¾è®¡ (Data Structure Design)

### 3.1 é…ç½®æ–‡ä»¶ç»“æ„

> è¯¦è§ [6.1 é…ç½®æ–‡ä»¶è§„æ ¼](#61-é…ç½®æ–‡ä»¶ç»“æ„-p2r_configjson)

### 3.2 äº¤ä»˜ç‰©ç›®å½•ç»“æ„ (Directory Output)

å‡è®¾è¾“å…¥å‚æ•°ä¸ºï¼š`Author=Vaswani`, `Year=2017`, `Title=Attention Is All You Need`ã€‚

**åœºæ™¯ Aï¼šPicGo ä¸Šä¼ æˆåŠŸ (äº‘ç«¯å›¾åºŠæ¨¡å¼)**

Plaintext

```
/Users/me/Documents/Paper_HTMLs/  (HTML åº“)
â””â”€â”€ Vaswani-2017-Attention Is All You Need.html

/Users/me/KnowledgeBase/Papers/   (Obsidian åº“)
â””â”€â”€ Vaswani-2017-Attention Is All You Need.md  (å†…éƒ¨å›¾ç‰‡é“¾æ¥ä¸º https://...)
```

**åœºæ™¯ Bï¼šPicGo å¤±è´¥ (æœ¬åœ°å›é€€æ¨¡å¼)**

Plaintext

```
/Users/me/KnowledgeBase/Papers/
â”œâ”€â”€ assets/
â”‚   â””â”€â”€ Vaswani-2017-Attention Is All You Need/
â”‚       â”œâ”€â”€ img1.png
â”‚       â””â”€â”€ img2.jpg
â””â”€â”€ Vaswani-2017-Attention Is All You Need.md  (å†…éƒ¨å›¾ç‰‡é“¾æ¥ä¸º assets/...)
```

### 3.3 Markdown Frontmatter (YAML) è§„èŒƒ

æ³¨å…¥åˆ°ç”Ÿæˆçš„ Markdown æ–‡ä»¶å¤´éƒ¨ï¼Œç”¨äº Obsidian ç´¢å¼•ã€‚

YAML

```
---
title: "Attention Is All You Need"
authors: ["Vaswani"]
year: 2017
# åŠ¨æ€å‚æ•°å°†è‡ªåŠ¨è¿½åŠ åˆ°è¿™é‡Œ
conference: "NIPS"
tags: [literature-note, unread]
# æ ¸å¿ƒå­—æ®µï¼šç‚¹å‡»å³å¯æ‰“å¼€ HTML
local_url: "file:///Users/me/Documents/Paper_HTMLs/Vaswani-2017-Attention Is All You Need.html"
created_date: 2026-01-15 10:00
---
```

---

## 4. ç•Œé¢ä¸äº¤äº’æµ (Interface & Interaction Flow)

### 4.1 åˆå§‹è®¾ç½®å‘å¯¼ (Setup Wizard)

ä½¿ç”¨ Rich `Panel` å’Œ `Prompt` æ„å»ºã€‚

Plaintext

```
â•­â”€â”€ p2r Setup Wizard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚                                                              â”‚
â”‚  [1/4] éªŒè¯ MinerU æœåŠ¡                                      â”‚
â”‚  è¯·è¾“å…¥ API Token: *********************** âœ…     â”‚
â”‚                                                              â”‚
â”‚  [2/4] è®¾ç½®å·¥ä½œåŒº                                            â”‚
â”‚  Obsidian è·¯å¾„: /Users/me/Obsidian                    âœ…     â”‚
â”‚  HTML åº“è·¯å¾„: /Users/me/HTML_Lib                      âœ…     â”‚
â”‚                                                              â”‚
â”‚  [3/4] å›¾ç‰‡æ‰˜ç®¡ (PicGo)                                      â”‚
â”‚  æ­£åœ¨è¿æ¥ 127.0.0.1:36677 ... è¿æ¥æˆåŠŸ ğŸŸ¢                    â”‚
â”‚  æ˜¯å¦å¯ç”¨è‡ªåŠ¨ä¸Šä¼ ? [Y/n]: Y                                  â”‚
â”‚                                                              â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

### 4.2 è¿è¡Œæ—¶é¢æ¿ (Runtime Dashboard)

ä½¿ç”¨ Rich `Progress` (å¤šè¿›åº¦æ¡) å±•ç¤ºå®æ—¶çŠ¶æ€ã€‚

Plaintext

```
$ p2r convert paper.pdf --author "He" --year "2016" --tag "ResNet"

â•­â”€â”€ p2r Processing: He-2016-ResNet â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚                                                              â”‚
â”‚  1. ä¸Šä¼ æ–‡ä»¶      [====================] 100% (Done)         â”‚
â”‚  2. äº‘ç«¯è§£æ      [==========>.........] 50%  (Page 10/20)   â”‚
â”‚  3. ä¸‹è½½ç»“æœ      [....................] 0%   (Waiting)      â”‚
â”‚  4. PicGoä¸Šä¼      [....................] 0%   (Waiting)      â”‚
â”‚                                                              â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

### 4.3 å®ŒæˆæŠ¥å‘Š (Completion Report)

Plaintext

```
âœ¨ å¤„ç†å®Œæˆ!
------------------------------------------------------------
ğŸ“„ ç¬”è®°å·²ç”Ÿæˆ: /Users/me/KnowledgeBase/Papers/He-2016-ResNet.md
ğŸŒ é˜…è¯»é“¾æ¥: file:///.../He-2016-ResNet.html (âŒ˜+Click æ‰“å¼€)
ğŸ–¼ï¸  å›¾ç‰‡çŠ¶æ€: 12 å¼ å›¾ç‰‡å·²ä¸Šä¼ è‡³ PicGo
------------------------------------------------------------
```

## 5. æŠ€æœ¯å†³ç­–ä¸çº¦æŸ (Technical Decisions & Constraints)

### 5.1 å¼€å‘æŠ€æœ¯æ ˆ

| é¡¹ç›® | é€‰æ‹© | ç†ç”± |
| :--- | :--- | :--- |
| è¯­è¨€ | Python 3.10+ | MinerU API å®˜æ–¹ç¤ºä¾‹å‡ä¸º Pythonï¼›ä¸°å¯Œçš„ CLI/PDF å¤„ç†ç”Ÿæ€ |
| CLI æ¡†æ¶ | Typer + Rich | ç±»å‹å®‰å…¨çš„å‘½ä»¤è¡Œå‚æ•°è§£æï¼›ç¾è§‚çš„ TUI è¾“å‡º |
| HTTP å®¢æˆ·ç«¯ | httpx | æ”¯æŒå¼‚æ­¥è¯·æ±‚ï¼Œé€‚åˆè½®è¯¢ä»»åŠ¡çŠ¶æ€ |
| PDF å…ƒæ•°æ® | pdfplumber | è½»é‡çº§ PDF è§£æï¼Œæå–å…ƒæ•°æ® |

### 5.2 è‡ªåŠ¨å…ƒæ•°æ®è¯†åˆ«ç­–ç•¥

ä¸ºå¹³è¡¡**ç¨³å®šæ€§**ä¸**æ•ˆç‡**ï¼Œé‡‡ç”¨ä¸‰çº§å›é€€æœºåˆ¶ï¼š

1. **PDF å†…ç½®å…ƒæ•°æ®** (æœ€ç¨³å®š)
   - ä½¿ç”¨ pdfplumber æå– PDF çš„ `/Title`, `/Author`, `/CreationDate` ç­‰å­—æ®µ
   - å¤§å¤šæ•°å­¦æœ¯ PDF ç”±å‡ºç‰ˆå•†ç”Ÿæˆï¼ŒåŒ…å«å®Œæ•´å…ƒæ•°æ®

2. **DOI æŸ¥è¯¢** (å¯é€‰å¢å¼º)
   - è‹¥æ–‡ä»¶åæˆ– PDF å…ƒæ•°æ®ä¸­åŒ…å« DOI (æ­£åˆ™åŒ¹é… `10.\d{4,}/[^\s]+`)
   - è°ƒç”¨ CrossRef API (`https://api.crossref.org/works/{doi}`) è·å–å®Œæ•´æ–‡çŒ®ä¿¡æ¯
   - æ­¤æ­¥éª¤ä¸ºå¯é€‰ï¼Œç½‘ç»œå¤±è´¥æ—¶è·³è¿‡

3. **ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥** (æœ€ç»ˆå›é€€)
   - è‹¥ä»¥ä¸Šæ–¹å¼å‡æ— æ³•è·å–ï¼Œä½¿ç”¨å‘½ä»¤è¡Œå‚æ•° `--author`, `--year`, `--title` ç­‰

### 5.3 MinerU é›†æˆè§„æ ¼

åŸºäº API æ–‡æ¡£ï¼Œç¡®å®šä»¥ä¸‹æŠ€æœ¯çº¦æŸï¼š

| çº¦æŸé¡¹ | å€¼ | è¯´æ˜ |
| :--- | :--- | :--- |
| å•æ–‡ä»¶å¤§å° | â‰¤ 200MB | API ç¡¬é™åˆ¶ |
| å•æ–‡ä»¶é¡µæ•° | â‰¤ 600 é¡µ | API ç¡¬é™åˆ¶ |
| æ¯æ—¥é«˜ä¼˜å…ˆçº§é¢åº¦ | 2000 é¡µ | è¶…å‡ºåä¼˜å…ˆçº§é™ä½ |
| æ”¯æŒæ ¼å¼ | pdf, doc(x), ppt(x), png, jpg, html | - |
| é»˜è®¤è¾“å‡º | markdown + json | å¯é¢å¤–è¯·æ±‚ htmlï¼ˆæœ¬å·¥å…·é»˜è®¤å¼€å¯ï¼‰ |
| æ¨¡å‹ç‰ˆæœ¬ | `vlm` (é»˜è®¤) | æ¯” pipeline æ›´æ™ºèƒ½ |

**API è°ƒç”¨æµç¨‹** (æœ¬åœ°æ–‡ä»¶)ï¼š
```
ç”³è¯·ä¸Šä¼ é“¾æ¥ â†’ PUT ä¸Šä¼ æ–‡ä»¶ â†’ è½®è¯¢ batch çŠ¶æ€ â†’ ä¸‹è½½ ZIP ç»“æœ
POST /file-urls/batch â†’ PUT {upload_url} â†’ GET /extract-results/batch/{id} â†’ GET {zip_url}
```

### 5.4 é”™è¯¯å¤„ç†ä¸æ¸…ç†ç­–ç•¥

**åŸåˆ™ï¼šä»»ä½•æƒ…å†µä¸‹ä¸ç•™åƒåœ¾æ–‡ä»¶**

| é˜¶æ®µ | å¤±è´¥åœºæ™¯ | å¤„ç†æ–¹å¼ |
| :--- | :--- | :--- |
| ä¸Šä¼  | ç½‘ç»œé”™è¯¯/API é”™è¯¯ | ç›´æ¥é€€å‡ºï¼Œæ— æ–‡ä»¶äº§ç”Ÿ |
| è§£æ | MinerU è¿”å› `failed` | è¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œä¸åˆ›å»ºä»»ä½•æœ¬åœ°æ–‡ä»¶ |
| ä¸‹è½½ | ZIP ä¸‹è½½å¤±è´¥ | é‡è¯• 3 æ¬¡åé€€å‡ºï¼Œä¸åˆ›å»ºæœ¬åœ°æ–‡ä»¶ |
| å›¾ç‰‡ä¸Šä¼  | PicGo å¤±è´¥ | è§¦å‘æœ¬åœ°å›é€€æœºåˆ¶ï¼ˆè§ 2.2ï¼‰ |
| ç”¨æˆ·ä¸­æ–­ | Ctrl+C | æ•è· SIGINTï¼Œæ¸…ç†ä¸´æ—¶æ–‡ä»¶åé€€å‡º |

**ä¸´æ—¶æ–‡ä»¶ç®¡ç†**ï¼š
- æ‰€æœ‰ä¸­é—´äº§ç‰©å­˜æ”¾äºç³»ç»Ÿä¸´æ—¶ç›®å½• (`tempfile.mkdtemp()`)
- ä»…åœ¨å…¨æµç¨‹æˆåŠŸåï¼Œæ‰å°†æœ€ç»ˆäº§ç‰©ç§»åŠ¨åˆ°ç›®æ ‡ç›®å½•
- è¿›ç¨‹é€€å‡ºæ—¶è‡ªåŠ¨æ¸…ç†ä¸´æ—¶ç›®å½•

### 5.5 é‡å¤æ–‡ä»¶å¤„ç†

å·¥å…·**ä¸ç»´æŠ¤å¤„ç†å†å²**ï¼Œä¿æŒè½»é‡ã€‚è‹¥ç›®æ ‡ä½ç½®å·²å­˜åœ¨åŒåæ–‡ä»¶ï¼š

```
Vaswani-2017-Attention Is All You Need.md      # å·²å­˜åœ¨
Vaswani-2017-Attention Is All You Need_v2.md   # æ–°ç”Ÿæˆ
Vaswani-2017-Attention Is All You Need_v3.md   # å†æ¬¡å¤„ç†
```

### 5.6 æ‰¹é‡å¤„ç†æ”¯æŒ

æ”¯æŒä»¥ä¸‹è¾“å…¥å½¢å¼ï¼š

```bash
# å•æ–‡ä»¶
p2r convert paper.pdf

# Glob æ¨¡å¼
p2r convert "*.pdf"
p2r convert "papers/*.pdf"

# ç›®å½•æ¨¡å¼ (å¤„ç†ç›®å½•ä¸‹æ‰€æœ‰ PDF)
p2r convert ./papers/

# å¤šæ–‡ä»¶
p2r convert paper1.pdf paper2.pdf paper3.pdf
```

æ‰¹é‡å¤„ç†æ—¶ï¼ŒMinerU çš„ batch API å¤©ç„¶æ”¯æŒå¹¶è¡Œè§£æï¼ˆå•æ¬¡æœ€å¤š 200 ä¸ªæ–‡ä»¶ï¼‰ã€‚

### 5.7 API Token å®‰å…¨å­˜å‚¨ (å¼€æºå‹å¥½)

ä½œä¸ºå¼€æºé¡¹ç›®ï¼Œéœ€æ”¯æŒå¤šç§å®‰å…¨çº§åˆ«çš„ Token é…ç½®æ–¹å¼ï¼š

| ä¼˜å…ˆçº§ | æ–¹å¼ | è¯´æ˜ |
| :--- | :--- | :--- |
| 1 | ç¯å¢ƒå˜é‡ `P2R_MINERU_TOKEN` | CI/CD å‹å¥½ï¼Œä¸å…¥åº“ |
| 2 | é…ç½®æ–‡ä»¶ `~/.p2r_config.json` | ä¾¿æ·ä½†éœ€æ³¨æ„æƒé™ (chmod 600) |

**å®‰å…¨æç¤º**ï¼š
- é…ç½®æ–‡ä»¶åˆ›å»ºæ—¶è‡ªåŠ¨è®¾ç½® `600` æƒé™
- `p2r configure` æ—¶æç¤ºç”¨æˆ·ç¯å¢ƒå˜é‡æ–¹å¼æ›´å®‰å…¨
- README ä¸­æ˜ç¡®è¯´æ˜ä¸è¦å°†é…ç½®æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶

### 5.8 å¯æ‰©å±•æ€§è®¾è®¡ (é¢„ç•™)

ä»¥ä¸‹åŠŸèƒ½ä½œä¸º**æ¨¡å—åŒ–é¢„ç•™**ï¼Œä¸åœ¨ MVP ä¸­å®ç°ï¼š

- [ ] æ–­ç‚¹ç»­ä¼  / ä»»åŠ¡æ¢å¤
- [ ] å¤šå›¾åºŠæ”¯æŒ (S3, R2, imgur)
- [ ] å…¶ä»–ç¬”è®°è½¯ä»¶é€‚é… (Logseq, Notion)
- [ ] æœ¬åœ° MinerU éƒ¨ç½²æ”¯æŒ

---

## 6. é…ç½®æ–‡ä»¶è§„æ ¼ (æ›´æ–°)

### 6.1 é…ç½®æ–‡ä»¶ç»“æ„ (`~/.p2r_config.json`)

```json
{
  "mineru_token": "YOUR_API_TOKEN",
  "paths": {
    "obsidian_vault": "/Users/me/KnowledgeBase/Papers",
    "html_library": "/Users/me/Documents/Paper_HTMLs"
  },
  "picgo": {
    "enable": true,
    "api_url": "http://127.0.0.1:36677/upload"
  },
  "naming": {
    "style": "standard",
    "template": "{author}-{year}-{title}",
    "rename_source_pdf": true
  },
  "mineru": {
    "model_version": "vlm",
    "enable_formula": true,
    "enable_table": true,
    "language": "en"
  },
  "frontmatter_template": {
    "tags": ["literature-note", "unread"]
  }
}
```

### 6.2 ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | ä¼˜å…ˆçº§ |
| :--- | :--- | :--- |
| `P2R_MINERU_TOKEN` | MinerU API Token | é«˜äºé…ç½®æ–‡ä»¶ |
| `P2R_CONFIG_PATH` | è‡ªå®šä¹‰é…ç½®æ–‡ä»¶è·¯å¾„ | - |

---

## 7. Frontmatter æ¨¡æ¿è‡ªå®šä¹‰

ç”¨æˆ·å¯åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰é¢å¤–çš„ frontmatter å­—æ®µï¼š

```json
{
  "frontmatter_template": {
    "tags": ["literature-note", "unread"],
    "status": "to-read",
    "custom_field": "value"
  }
}
```

ç”Ÿæˆçš„ Markdown å°†åˆå¹¶ç”¨æˆ·æ¨¡æ¿ä¸åŠ¨æ€å­—æ®µï¼š

```yaml
---
title: "Attention Is All You Need"
authors: ["Vaswani"]
year: 2017
conference: "NIPS"
tags: [literature-note, unread]  # æ¥è‡ªæ¨¡æ¿
status: "to-read"                # æ¥è‡ªæ¨¡æ¿
custom_field: "value"            # æ¥è‡ªæ¨¡æ¿
local_url: "file:///..."         # åŠ¨æ€ç”Ÿæˆ
created_date: 2026-01-15 10:00   # åŠ¨æ€ç”Ÿæˆ
---
```

---

## 8. Action Plan (å¼€å‘è·¯çº¿)

### Phase 1: é¡¹ç›®éª¨æ¶ä¸ MinerU é›†æˆ âœ…

**ç›®æ ‡**ï¼šéªŒè¯ MinerU API å¯ç”¨æ€§ï¼Œå®Œæˆæ ¸å¿ƒè§£ææµç¨‹

- [x] åˆå§‹åŒ– Python é¡¹ç›®ç»“æ„ (pyproject.toml, src/, tests/)
- [x] å®ç°é…ç½®ç®¡ç†æ¨¡å— (è¯»å–/å†™å…¥ ~/.p2r_config.json)
- [x] å®ç° MinerU API å®¢æˆ·ç«¯
  - [x] æ–‡ä»¶ä¸Šä¼ é“¾æ¥ç”³è¯·
  - [x] æ–‡ä»¶ä¸Šä¼  (PUT)
  - [x] ä»»åŠ¡çŠ¶æ€è½®è¯¢
  - [x] ZIP ç»“æœä¸‹è½½ä¸è§£å‹
- [x] æ·»åŠ åŸºç¡€ CLI å‘½ä»¤ (`p2r convert`)
- [x] **æµ‹è¯•ç‚¹**ï¼šæ‰‹åŠ¨æµ‹è¯•ä¸åŒç±»å‹ PDF çš„è§£ææ•ˆæœ

### Phase 2: å…ƒæ•°æ®æå–ä¸æ–‡ä»¶å¤„ç†

**ç›®æ ‡**ï¼šå®Œæˆæ–‡ä»¶é‡å‘½åå’Œå…ƒæ•°æ®æ³¨å…¥

- [ ] å®ç° PDF å…ƒæ•°æ®æå– (pdfplumber)
- [ ] å®ç° DOI æ­£åˆ™åŒ¹é…ä¸ CrossRef æŸ¥è¯¢ (å¯é€‰)
- [ ] å®ç°å‘½åæ¨¡æ¿å¼•æ“
- [ ] å®ç° Frontmatter ç”Ÿæˆä¸æ³¨å…¥ï¼ˆåŒ…å« `local_url` æŒ‡å‘ HTMLï¼‰
- [ ] å®ç°æ–‡ä»¶ç§»åŠ¨é€»è¾‘ (ä¸´æ—¶ç›®å½• â†’ ç›®æ ‡ç›®å½•)
- [ ] å®ç°é‡å¤æ–‡ä»¶ç‰ˆæœ¬å·é€’å¢
- [ ] å®ç°æº PDF åŸåœ°é‡å‘½å

### Phase 3: PicGo é›†æˆä¸å›é€€æœºåˆ¶

**ç›®æ ‡**ï¼šå®Œæˆå›¾ç‰‡æ‰˜ç®¡åŠŸèƒ½

- [ ] å®ç° PicGo API å®¢æˆ·ç«¯
- [ ] å®ç° Markdown å›¾ç‰‡é“¾æ¥æ›¿æ¢
- [ ] å®ç° PicGo å¤±è´¥å›é€€ (æœ¬åœ° assets ç›®å½•)
- [ ] å®ç° HTML å›¾ç‰‡è·¯å¾„å¤„ç†

### Phase 4: äº¤äº’ä½“éªŒä¼˜åŒ–

**ç›®æ ‡**ï¼šå®Œå–„ CLI äº¤äº’ä¸é”™è¯¯å¤„ç†

- [ ] å®ç° `p2r configure` äº¤äº’å¼å‘å¯¼ (Rich TUI)
- [ ] å®ç°è¿è¡Œæ—¶è¿›åº¦é¢æ¿ (å¤šè¿›åº¦æ¡)
- [ ] å®ç°å®ŒæˆæŠ¥å‘Šè¾“å‡º
- [ ] å®ç° Ctrl+C ä¸­æ–­å¤„ç†ä¸ä¸´æ—¶æ–‡ä»¶æ¸…ç†
- [ ] å®ç°æ‰¹é‡æ–‡ä»¶è¾“å…¥æ”¯æŒ (glob, ç›®å½•, å¤šæ–‡ä»¶)

### Phase 5: æµ‹è¯•ä¸æ–‡æ¡£

**ç›®æ ‡**ï¼šç¡®ä¿ç¨³å®šæ€§ï¼Œå‡†å¤‡å¼€æºå‘å¸ƒ

- [ ] ç¼–å†™å•å…ƒæµ‹è¯• (æ ¸å¿ƒæ¨¡å—)
- [ ] ç¼–å†™é›†æˆæµ‹è¯• (ç«¯åˆ°ç«¯æµç¨‹)
- [ ] ç¼–å†™ README.md (å®‰è£…ã€é…ç½®ã€ä½¿ç”¨)
- [ ] æ·»åŠ  CI é…ç½® (GitHub Actions)
- [ ] å‘å¸ƒåˆ° PyPI

### Phase 6: æ‰©å±•åŠŸèƒ½ (å¯é€‰)

- [ ] æ–­ç‚¹ç»­ä¼  / ä»»åŠ¡æ¢å¤
- [ ] å¤šå›¾åºŠæ”¯æŒ
- [ ] å…¶ä»–ç¬”è®°è½¯ä»¶é€‚é…

### Phase X: é«˜çº§å†…å®¹å¤„ç† (æ¢ç´¢æ€§ / ç‹¬ç«‹äº§å“æ–¹å‘)

**èƒŒæ™¯**ï¼šMinerU çš„é»˜è®¤è¾“å‡ºå­˜åœ¨ä¸€äº›å±€é™æ€§ï¼ŒåŒ…æ‹¬ï¼š

1. **è„šæ³¨ä¸¢å¤±**ï¼š`page_footnote` ç±»å‹çš„å†…å®¹ä¸ä¼šå‡ºç°åœ¨ `full.md` / `full.html` ä¸­
2. **è¯†åˆ«ä¸ä¸€è‡´**ï¼šè¾ƒé•¿çš„æ³¨é‡Šæœ‰æ—¶è¢«è¯†åˆ«ä¸ºæ™®é€šæ–‡æœ¬ï¼ˆä¿ç•™ï¼‰ï¼Œæœ‰æ—¶è¢«è¯†åˆ«ä¸ºè„šæ³¨ï¼ˆä¸¢å¼ƒï¼‰
3. **æ ‡é¢˜å±‚çº§æ‰å¹³åŒ–**ï¼šæ‰€æœ‰æ ‡é¢˜éƒ½è¢«æ ‡è®°ä¸º `text_level: 1`ï¼Œä¸¢å¤±å±‚çº§ä¿¡æ¯
4. **è·¨é¡µæ®µè½å¤„ç†**ï¼šå¯èƒ½å­˜åœ¨æ®µè½è¢«æˆªæ–­çš„æƒ…å†µ

**å·²æ¢ç´¢çš„æ–¹æ¡ˆ**ï¼š

| æ–¹æ¡ˆ | æè¿° | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|------|
| ç¼–è¾‘ full.md | ä» JSON æå–è„šæ³¨ï¼Œæ³¨å…¥åˆ°ç°æœ‰æ–‡ä»¶ | ä¿ç•™ MinerU çš„æ ¼å¼å¤„ç† | æ— æ³•ç²¾ç¡®å®šä½é¡µå†…ä½ç½® |
| ä» JSON é‡å»º | å®Œå…¨åŸºäº content_list.json é‡å»ºæ–‡æ¡£ | è„šæ³¨ä½ç½®ç²¾ç¡®ï¼Œå®Œå…¨å¯æ§ | éœ€è¦é‡æ–°å®ç°æ ¼å¼è½¬æ¢é€»è¾‘ |
| JSON é˜…è¯»å™¨ | å¼€å‘å¯è§†åŒ–å·¥å…·ç›´æ¥æ¸²æŸ“ JSON | äº¤äº’æ€§å¼ºï¼Œä¿ç•™å®Œæ•´å…ƒæ•°æ® | å¼€å‘æˆæœ¬é«˜ï¼Œè„±ç¦»ç¬”è®°æµç¨‹ |

**æœªæ¥å¯èƒ½çš„æ–¹å‘**ï¼š

- **Diff + AI åå¤„ç†**ï¼šå¯¹æ¯” `content_list.json` ä¸ `full.md` çš„å†…å®¹å·®å¼‚ï¼Œç”Ÿæˆ diffï¼Œç”± AI è¿›è¡Œæ™ºèƒ½åå¤„ç†ï¼ˆåˆå¹¶è„šæ³¨ã€ä¿®æ­£æ®µè½åˆ’åˆ†ã€ä¼˜åŒ–æ ¼å¼ç­‰ï¼‰
- **äº¤äº’å¼ç¼–è¾‘å™¨**ï¼šæä¾› TUI/Web ç•Œé¢ï¼Œè®©ç”¨æˆ·é¢„è§ˆå¹¶æ‰‹åŠ¨è°ƒæ•´å†…å®¹ç»“æ„
- **ç‹¬ç«‹çš„æ–‡æ¡£ä¼˜åŒ–å·¥å…·**ï¼šä½œä¸º p2r çš„ä¸‹æ¸¸å·¥å…·ï¼Œä¸“é—¨å¤„ç†å­¦æœ¯æ–‡æ¡£çš„æ ¼å¼ä¼˜åŒ–

**å½“å‰å†³ç­–**ï¼šå¯¹äº p2r CLI å·¥å…·çš„ MVPï¼Œç›´æ¥ä½¿ç”¨ MinerU çš„åŸå§‹è¾“å‡ºï¼ˆ`full.md` + `full.html`ï¼‰å·²è¶³å¤Ÿæ»¡è¶³åŸºæœ¬éœ€æ±‚ã€‚é«˜çº§å†…å®¹å¤„ç†ä½œä¸ºç‹¬ç«‹äº§å“æ–¹å‘è¿›è¡Œæ¢ç´¢ï¼Œä¸é˜»å¡ä¸»çº¿å¼€å‘ã€‚

> è¯¦ç»†çš„æŠ€æœ¯åˆ†æå’Œå®éªŒè®°å½•è§ `doc/phase2_plan.md`

---

## 9. å‘½ä»¤è¡Œæ¥å£é€ŸæŸ¥ (CLI Reference)

```bash
# é…ç½®å‘å¯¼
p2r configure

# å•æ–‡ä»¶è½¬æ¢
p2r convert paper.pdf
p2r convert paper.pdf --author "He" --year "2016" --title "ResNet"

# æ‰¹é‡è½¬æ¢
p2r convert "*.pdf"
p2r convert ./papers/
p2r convert paper1.pdf paper2.pdf

# æŸ¥çœ‹é…ç½®
p2r config show

# ç‰ˆæœ¬ä¿¡æ¯
p2r --version
```

---

## 10. æœ¯è¯­è¡¨ (Glossary)

| æœ¯è¯­ | è¯´æ˜ |
| :--- | :--- |
| MinerU | OpenDataLab æä¾›çš„ PDF è§£æäº‘æœåŠ¡ |
| PicGo | å¼€æºå›¾åºŠä¸Šä¼ å·¥å…·ï¼Œæ”¯æŒå¤šç§å›¾åºŠåç«¯ |
| Frontmatter | Markdown æ–‡ä»¶å¤´éƒ¨çš„ YAML å…ƒæ•°æ®å— |
| VLM | Vision-Language Modelï¼ŒMinerU çš„é«˜çº§è§£ææ¨¡å‹ |
